<!DOCTYPE html>
<html>
<head>
    <title>Voice Recorder</title>
    <style>
        button {
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Voice Recorder</h1>

    <button id="recordButton" disabled>Record</button>
    <button id="stopButton" disabled>Stop</button>
    <button id="playButton" disabled>Play</button>

    <h2>Recordings:</h2>
    <ul id="recordingsList"></ul>

    <script>
        var recordButton = document.getElementById('recordButton');
        var stopButton = document.getElementById('stopButton');
        var playButton = document.getElementById('playButton');
        var recordingsList = document.getElementById('recordingsList');

        var mediaRecorder;
        var chunks = [];

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function (stream) {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();

                    recordButton.disabled = true;
                    stopButton.disabled = false;
                    playButton.disabled = true;

                    chunks = [];
                })
                .catch(function (err) {
                    console.log('Unable to access the microphone:', err);
                });
        }

        function stopRecording() {
            mediaRecorder.stop();
        }

        function playRecording(audioURL) {
            var audio = new Audio(audioURL);
            audio.play();
        }

        function deleteRecording(audioURL) {
            localStorage.removeItem('recording_' + audioURL);
            displayRecordings();
        }

        function displayRecordings() {
            recordingsList.innerHTML = '';

            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key.startsWith('recording_')) {
                    var audioURL = localStorage.getItem(key);

                    var li = document.createElement('li');
                    var audio = document.createElement('audio');
                    var playButton = document.createElement('button');
                    var deleteButton = document.createElement('button');

                    audio.controls = true;
                    audio.src = audioURL;

                    playButton.textContent = 'Play';
                    playButton.addEventListener('click', function () {
                        playRecording(audioURL);
                    });

                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', function () {
                        li.remove();
                        deleteRecording(audioURL);
                    });

                    li.appendChild(audio);
                    li.appendChild(playButton);
                    li.appendChild(deleteButton);
                    recordingsList.appendChild(li);
                }
            }
        }

        recordButton.addEventListener('click', startRecording);
        stopButton.addEventListener('click', stopRecording);

        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.addEventListener('dataavailable', function (e) {
            chunks.push(e.data);
        });

        mediaRecorder.addEventListener('stop', function () {
            var blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });
            chunks = [];

            var audioURL = URL.createObjectURL(blob);
            var timestamp = new Date().getTime();

            localStorage.setItem('recording_' + timestamp, audioURL);

            displayRecordings();

            recordButton.disabled = false;
            stopButton.disabled = true;
            playButton.disabled = false;
        });

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            recordButton.disabled = false;
        } else {
            console.log('getUserMedia is not supported on your browser');
        }

        displayRecordings();
    </script>
</body>
</html>
